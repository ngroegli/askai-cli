# AskAI CLI - Component Dependencies and Relationships (Layered Architecture)
title: "Component Dependencies & Relationships"

# Note: Enhanced layered architecture with clear separation of concerns
# Shared layer provides common services to all other layers
# Modules layer contains core business logic organized by domain
# Presentation layer handles user interface
# Infrastructure layer manages external output processing

# Main Application
main: "askai.py" {
  style.fill: "#90CAF9" # Light Blue (core app)
  style.stroke: "#1976D2"
}

# Shared Layer (Common Infrastructure)
shared_layer: "Shared Layer" {
  shape: rectangle
  style.fill: "#F5F5F5" # Light Gray background
  style.stroke: "#757575"

  config_loader: "config/loader.py" { style.fill: "#BDBDBD" }
  logging_setup: "logging/setup.py" { style.fill: "#BDBDBD" }
  utils_helpers: "utils/helpers.py" { style.fill: "#BDBDBD" }
}

# Presentation Layer
presentation_layer: "Presentation Layer" {
  shape: rectangle
  style.fill: "#F3E5F5" # Light Purple background
  style.stroke: "#9C27B0"

  # CLI Components
  cli_group: "CLI Interface" {
    shape: rectangle
    style.fill: "#E1BEE7" # Darker purple for CLI
    style.stroke: "#7B1FA2"
    
    cli_parser: "cli/cli_parser.py" { style.fill: "#CE93D8" }
    command_handler: "cli/command_handler.py" { style.fill: "#CE93D8" }
    banner_parser: "cli/banner_argument_parser.py" { style.fill: "#CE93D8" }
  }
  
  # TUI Components
  tui_group: "TUI Interface" {
    shape: rectangle
    style.fill: "#C8E6C9" # Light green for TUI
    style.stroke: "#388E3C"
    
    unified_tui_app: "tui/apps/unified_tui_app.py" { style.fill: "#A5D6A7" }
    question_builder: "tui/apps/question_builder.py" { style.fill: "#A5D6A7" }
    pattern_browser: "tui/apps/pattern_browser.py" { style.fill: "#A5D6A7" }
    main_tui_app: "tui/apps/main_tui_app.py" { style.fill: "#81C784" }
    loading_screen: "tui/components/loading_screen.py" { style.fill: "#A5D6A7" }
    tui_widgets: "tui/widgets/" { style.fill: "#A5D6A7" }
    tui_utils: "tui/utils/" { style.fill: "#A5D6A7" }
  }
}

# Modules Layer (Core Business Logic)
modules_layer: "Modules Layer" {
  shape: rectangle
  style.fill: "#E8F5E9" # Light Green background
  style.stroke: "#4CAF50"

  # AI Module
  ai_service: "ai/ai_service.py" { style.fill: "#A5D6A7" }
  openrouter_client: "ai/openrouter_client.py" { style.fill: "#A5D6A7" }

  # Patterns Module
  pattern_manager: "patterns/pattern_manager.py" { style.fill: "#A5D6A7" }
  pattern_input: "patterns/pattern_inputs.py" { style.fill: "#A5D6A7" }
  pattern_output: "patterns/pattern_outputs.py" { style.fill: "#A5D6A7" }
  pattern_config: "patterns/pattern_configuration.py" { style.fill: "#A5D6A7" }

  # Questions Module (NEW)
  question_processor: "questions/processor.py" { style.fill: "#81C784" }
  question_models: "questions/models.py" { style.fill: "#81C784" }

  # Chat Module
  chat_manager: "chat/chat_manager.py" { style.fill: "#A5D6A7" }

  # Messaging Module
  message_builder: "messaging/builder.py" { style.fill: "#A5D6A7" }
}

# Infrastructure Layer
infrastructure_layer: "Infrastructure Layer" {
  shape: rectangle
  style.fill: "#FFF9C4" # Light Yellow background
  style.stroke: "#FF9800"

  output_coordinator: "output/output_coordinator.py" { style.fill: "#FFF176" }
  content_extractor: "output/processors/content_extractor.py" { style.fill: "#FFF176" }
  response_normalizer: "output/processors/response_normalizer.py" { style.fill: "#FFF176" }
  pattern_processor: "output/processors/pattern_processor.py" { style.fill: "#FFF176" }
  directory_manager: "output/processors/directory_manager.py" { style.fill: "#FFF176" }
  terminal_formatter: "output/display_formatters/terminal_formatter.py" { style.fill: "#FFF176" }
  file_writer_chain: "output/file_writers/file_writer_chain.py" { style.fill: "#FFF176" }
}

# Main Dependencies (Cross-Layer)
main -> shared_layer: "Uses shared services"
main -> presentation_layer: "UI interaction"
main -> modules_layer: "Business logic"

# Presentation Layer Dependencies
presentation_layer -> modules_layer: "Service calls"
presentation_layer -> shared_layer: "Common services"

# Modules Layer Dependencies
modules_layer -> infrastructure_layer: "Output processing"
modules_layer -> shared_layer: "Common services"

# Infrastructure Layer Dependencies
infrastructure_layer -> shared_layer: "Common services"

# Specific Component Dependencies
main -> cli_parser: "Argument parsing"
main -> unified_tui_app: "TUI mode entry"
main -> question_processor: "Question handling"
cli_parser -> command_handler: "Command routing"
command_handler -> pattern_manager: "Pattern operations"
command_handler -> chat_manager: "Chat operations"
command_handler -> unified_tui_app: "Interactive mode"
unified_tui_app -> question_builder: "Question workflow"
unified_tui_app -> pattern_browser: "Pattern workflow"
question_builder -> question_processor: "Question execution"
pattern_browser -> pattern_manager: "Pattern operations"
loading_screen -> ai_service: "Progress feedback"
ai_service -> openrouter_client: "API communication"
pattern_manager -> pattern_input: "Input validation"
pattern_manager -> pattern_output: "Output definition"
output_coordinator -> content_extractor: "Content processing"
output_coordinator -> file_writer_chain: "File operations"
message_builder -> pattern_manager: "Template application"
question_processor -> ai_service: "AI interactions"
question_processor -> message_builder: "Message construction"
tui_group -> modules_layer: "Business logic calls"
tui_utils -> shared_layer: "TUI compatibility"
