# AskAI CLI - Component Dependencies and Relationships (Layered Architecture)
title: "Component Dependencies & Relationships"

# Note: Enhanced layered architecture with clear separation of concerns
# Shared layer provides common services to all other layers
# Modules layer contains core business logic organized by domain
# Presentation layer handles user interface
# Infrastructure layer manages external output processing

# Main Application
main: "askai.py" {
  style.fill: "#90CAF9" # Light Blue (core app)
  style.stroke: "#1976D2"
}

# Shared Layer (Common Infrastructure)
shared_layer: "Shared Layer" {
  shape: rectangle
  style.fill: "#FAFAFA" # Light Gray background for Infrastructure
  style.stroke: "#757575"

  config_loader: "config/loader.py" { style.fill: "#BDBDBD" }
  logging_setup: "logging/setup.py" { style.fill: "#BDBDBD" }
  utils_helpers: "utils/helpers.py" { style.fill: "#BDBDBD" }
}

# Presentation Layer
presentation_layer: "Presentation Layer" {
  shape: rectangle
  style.fill: "#F3E5F5" # Light Purple background
  style.stroke: "#9C27B0"

  # CLI Components
  cli_group: "CLI Interface" {
    shape: rectangle
    style.fill: "#E1BEE7" # Darker purple for CLI
    style.stroke: "#7B1FA2"

    cli_parser: "cli/cli_parser.py" { style.fill: "#CE93D8" }
    command_handler: "cli/command_handler.py" { style.fill: "#CE93D8" }
    banner_parser: "cli/banner_argument_parser.py" { style.fill: "#CE93D8" }
  }

  # TUI Components - Simplified Tabbed Architecture
  tui_interface: "TUI Interface" {
    shape: rectangle
    style.fill: "#F3E5F5" # Light purple background for UI
    style.stroke: "#9C27B0"

    question_tab: "Question Tab" { style.fill: "#CE93D8" }
    pattern_tab: "Pattern Tab" { style.fill: "#CE93D8" }
    chat_tab: "Chat Tab" { style.fill: "#CE93D8" }
    model_tab: "Model Tab" { style.fill: "#CE93D8" }
    credits_tab: "Credits Tab" { style.fill: "#CE93D8" }
  }
}

# Modules Layer (Core Business Logic)
modules_layer: "Modules Layer" {
  shape: rectangle
  style.fill: "#E8F5E9" # Light Green background for Data Processing
  style.stroke: "#4CAF50"

  # AI Module
  ai_service: "ai/ai_service.py" { style.fill: "#A5D6A7" }
  openrouter_client: "ai/openrouter_client.py" { style.fill: "#A5D6A7" }

  # Patterns Module
  pattern_manager: "patterns/pattern_manager.py" { style.fill: "#A5D6A7" }
  pattern_input: "patterns/pattern_inputs.py" { style.fill: "#A5D6A7" }
  pattern_output: "patterns/pattern_outputs.py" { style.fill: "#A5D6A7" }
  pattern_config: "patterns/pattern_configuration.py" { style.fill: "#A5D6A7" }

  # Questions Module (NEW)
  question_processor: "questions/processor.py" { style.fill: "#A5D6A7" }
  question_models: "questions/models.py" { style.fill: "#A5D6A7" }

  # Chat Module
  chat_manager: "chat/chat_manager.py" { style.fill: "#A5D6A7" }

  # Messaging Module
  message_builder: "messaging/builder.py" { style.fill: "#A5D6A7" }
}

# Infrastructure Layer
infrastructure_layer: "Infrastructure Layer" {
  shape: rectangle
  style.fill: "#FAFAFA" # Light Gray background for Infrastructure
  style.stroke: "#757575"

  output_coordinator: "output/output_coordinator.py" { style.fill: "#BDBDBD" }
  content_extractor: "output/processors/content_extractor.py" { style.fill: "#BDBDBD" }
  response_normalizer: "output/processors/response_normalizer.py" { style.fill: "#BDBDBD" }
  pattern_processor: "output/processors/pattern_processor.py" { style.fill: "#BDBDBD" }
  directory_manager: "output/processors/directory_manager.py" { style.fill: "#BDBDBD" }
  terminal_formatter: "output/display_formatters/terminal_formatter.py" { style.fill: "#BDBDBD" }
  file_writer_chain: "output/file_writers/file_writer_chain.py" { style.fill: "#BDBDBD" }
}

# Main Dependencies (Cross-Layer)
main -> shared_layer: "Uses shared services"
main -> presentation_layer: "UI interaction"
main -> modules_layer: "Business logic"

# Presentation Layer Dependencies
presentation_layer -> modules_layer: "Service calls"
presentation_layer -> shared_layer: "Common services"

# Modules Layer Dependencies
modules_layer -> infrastructure_layer: "Output processing"
modules_layer -> shared_layer: "Common services"

# Infrastructure Layer Dependencies
infrastructure_layer -> shared_layer: "Common services"
